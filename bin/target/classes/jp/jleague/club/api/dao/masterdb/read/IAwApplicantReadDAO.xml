<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.jleague.club.api.dao.masterdb.read.IAwApplicantReadDAO">

	<resultMap type="jp.jleague.club.api.dao.masterdb.dto.IAwApplicantDTO" id="dto">
		<result column="awards_applicant_id" property="awardsApplicantId" />
		<result column="awards_event_id" property="awardsEventId" />
		<result column="member_id" property="memberId" />
		<result column="applicant_datetime" property="applicantDatetime" />
		<result column="applicant_winning_flg" property="applicantWinningFlg" />
		<result column="awards_ticket_id" property="awardsTicketId" />
		<result column="name" property="name" />
		<result column="name_kana" property="nameKana" />
		<result column="sex" property="sex" />
		<result column="birthday" property="birthday" />
		<result column="mail_address" property="mailAddress" />
		<result column="zip_code" property="zipCode" />
		<result column="prefecture" property="prefecture" />
		<result column="city" property="city" />
		<result column="building" property="building" />
		<result column="tel" property="tel" />
		<result column="clubId" property="clubId" />
		<result column="seat_type" property="seatType" />
		<result column="companion1" property="companion1" />
		<result column="companion2" property="companion2" />
		<result column="companion3" property="companion3" />
		<result column="regist_datetime" property="registDatetime" />
		<result column="update_datetime" property="updateDatetime" />
		<result column="serial_id" property="serialId" />
	</resultMap>

	<select id="selectListByMemberIdNow" resultMap="dto" parameterType="java.util.Map">
		select
			  app.awards_applicant_id
			, app.awards_event_id
			, app.member_id
			, app.applicant_datetime
			, app.applicant_winning_flg
			, app.awards_ticket_id
			, app.name
			, app.name_kana
			, app.sex
			, app.birthday
			, app.mail_address
			, app.zip_code
			, app.prefecture
			, app.city
			, app.building
			, app.tel
			, app.club_id
			, app.seat_type
			, app.companion1
			, app.companion2
			, app.companion3
			, app.regist_datetime
			, app.update_datetime
			, ti.serial_id
		from i_aw_applicant app
		inner join i_aw_event ev 
		on app.awards_event_id = ev.awards_event_id
		inner join i_aw_ticket ti
		on app.awards_ticket_id = ti.awards_ticket_id
		where app.member_id = #{memberId}
		and app.applicant_datetime <![CDATA[<=]]> #{now}
		and ev.event_datetime >= #{now}
		<if test="winningFlg != null">
		and app.applicant_winning_flg = #{winningFlg}
		</if>
	</select>

</mapper>
