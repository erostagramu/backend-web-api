<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.jleague.club.api.dao.masterdb.write.IBcMemberMedalStatusWriteDAO">

	<resultMap type="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO" id="IBcMemberMedalStatusDTO">
		<result column="member_id" property="memberId" javaType="java.lang.String" />
		<result column="acquisition_medal_num" property="acquisitionMedalNum" javaType="java.lang.Integer" />
		<result column="star_num" property="starNum" javaType="java.lang.Integer" />
		<result column="rank" property="rank" javaType="java.lang.Integer" />
		<result column="rank_update_datetime" property="rankUpdateDatetime" javaType="java.util.Date" />
		<result column="jchallenge_impl_possible_times" property="jchallengeImplPossibleTimes" javaType="java.lang.Integer" />
		<result column="favorite_club_config" property="favoriteClubConfig" javaType="java.lang.Integer" />
		<result column="member_info_regist" property="memberInfoRegist" javaType="java.lang.Integer" />
		<result column="otp_id_regist" property="otpIdRegist" javaType="java.lang.Integer" />
		<result column="continuation_medal" property="continuationMedal" javaType="java.lang.Integer" />
		<result column="aeon_checkin_arrival_num" property="aeonCheckinArrivalNum" javaType="java.lang.Integer" />
		<result column="sns_share_arrival_num" property="snsShareArrivalNum" javaType="java.lang.Integer" />
		<result column="latest_sns_share_challenge_imple_datetime" property="latestSnsShareChallengeImpleDatetime" javaType="java.util.Date" />
		<result column="sns_share_challenge_possible_flg" property="snsShareChallengePossibleFlg" javaType="java.lang.Integer" />
		<result column="login_num" property="loginNum" javaType="java.lang.Integer" />
		<result column="login_level" property="loginLevel" javaType="java.lang.Integer" />
		<result column="final_login_datetime" property="finalLoginDatetime" javaType="java.util.Date" />
		<result column="stadium_checkin_num" property="stadiumCheckinNum" javaType="java.lang.Integer" />
		<result column="stadium_checkin_level" property="stadiumCheckinLevel" javaType="java.lang.Integer" />
		<result column="meijiyasuda_event_final_join_date" property="meijiyasudaEventFinalJoinDate" javaType="java.util.Date" />
		<result column="ad_code_input_datetime" property="adCodeInputDatetime" javaType="java.util.Date" />
		<result column="not_yet_acquired_ad_code_medal" property="notYetAcquiredAdCodeMedal" javaType="java.lang.Integer" />
		<result column="not_yet_acquired_apology_bonus_medal_flg" property="notYetAcquiredApologyBonusMedalFlg" javaType="java.lang.Integer" />
		<result column="done_stadium_checkin_flg" property="doneStadiumCheckinFlg" javaType="java.lang.Integer" />
		<result column="regist_datetime" property="registDatetime" javaType="java.util.Date" />
		<result column="update_datetime" property="updateDatetime" javaType="java.util.Date" />
	</resultMap>

	<select id="selectMemberMedalStatus" parameterType="java.lang.String" resultMap="IBcMemberMedalStatusDTO">
		select member_id,
			star_num,
			rank,
			rank_update_datetime,
			jchallenge_impl_possible_times,
			favorite_club_config,
			member_info_regist,
			acquisition_medal_num,
			otp_id_regist,
			continuation_medal,
			aeon_checkin_arrival_num,
			sns_share_arrival_num,
			latest_sns_share_challenge_imple_datetime,
			sns_share_challenge_possible_flg,
			login_num,
			login_level,
			final_login_datetime,
			stadium_checkin_num,
			stadium_checkin_level,
			meijiyasuda_event_final_join_date,
			ad_code_input_datetime,
			not_yet_acquired_ad_code_medal,
			not_yet_acquired_apology_bonus_medal_flg,
			done_stadium_checkin_flg,
			regist_datetime,
			update_datetime
		from i_bc_member_medal_status
		where member_id = #{memberId}
	</select>

	<update id="updateMedalAcquisitionStatus" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO">
		update i_bc_member_medal_status
		set
			member_id = #{memberId}
			, acquisition_medal_num = #{acquisitionMedalNum}
			, star_num = #{starNum}
			, rank = #{rank}
			, rank_update_datetime = #{rankUpdateDatetime}
			, jchallenge_impl_possible_times = #{jchallengeImplPossibleTimes}
			, favorite_club_config = #{favoriteClubConfig}
			, member_info_regist = #{memberInfoRegist}
			, otp_id_regist = #{otpIdRegist}
			, continuation_medal = #{continuationMedal}
			, aeon_checkin_arrival_num = #{aeonCheckinArrivalNum}
			, sns_share_arrival_num = #{snsShareArrivalNum}
			, latest_sns_share_challenge_imple_datetime = #{latestSnsShareChallengeImpleDatetime}
			, sns_share_challenge_possible_flg = #{snsShareChallengePossibleFlg}
			, login_num = #{loginNum}
			, login_level = #{loginLevel}
			, final_login_datetime = #{finalLoginDatetime}
			, stadium_checkin_num = #{stadiumCheckinNum}
			, stadium_checkin_level = #{stadiumCheckinLevel}
			, meijiyasuda_event_final_join_date = #{meijiyasudaEventFinalJoinDate}
			, ad_code_input_datetime = #{adCodeInputDatetime}
			, not_yet_acquired_ad_code_medal = #{notYetAcquiredAdCodeMedal}
			, not_yet_acquired_apology_bonus_medal_flg = #{notYetAcquiredApologyBonusMedalFlg}
			, done_stadium_checkin_flg = #{doneStadiumCheckinFlg}
			, update_datetime = #{updateDatetime}
		where
			member_id = #{memberId}
	</update >

<insert id="insert" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO">
insert into i_bc_member_medal_status
(
	member_id,
	acquisition_medal_num,
	star_num,
	rank,
	rank_update_datetime,
	jchallenge_impl_possible_times,
	favorite_club_config,
	member_info_regist,
	otp_id_regist,
	continuation_medal,
	aeon_checkin_arrival_num,
	sns_share_arrival_num,
	latest_sns_share_challenge_imple_datetime,
	sns_share_challenge_possible_flg,
	login_num,
	login_level,
	final_login_datetime,
	stadium_checkin_num,
	stadium_checkin_level,
	meijiyasuda_event_final_join_date,
	ad_code_input_datetime,
	not_yet_acquired_ad_code_medal,
	not_yet_acquired_apology_bonus_medal_flg,
	regist_datetime,
	update_datetime
)
values
(
	#{memberId},
	#{acquisitionMedalNum},
	#{starNum},
	#{rank},
	#{rankUpdateDatetime},
	#{jchallengeImplPossibleTimes},
	#{favoriteClubConfig},
	#{memberInfoRegist},
	#{otpIdRegist},
	#{continuationMedal},
	#{aeonCheckinArrivalNum},
	#{snsShareArrivalNum},
	#{latestSnsShareChallengeImpleDatetime},
	#{snsShareChallengePossibleFlg},
	#{loginNum},
	#{loginLevel},
	#{finalLoginDatetime},
	#{stadiumCheckinNum},
	#{stadiumCheckinLevel},
	#{meijiyasudaEventFinalJoinDate},
	#{adCodeInputDatetime},
	#{notYetAcquiredAdCodeMedal},
	#{notYetAcquiredApologyBonusMedalFlg},
	#{registDatetime},
	#{updateDatetime}
)

</insert>


<update id="update" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO" >
update i_bc_member_medal_status
set
	member_id = #{memberId},
	acquisition_medal_num = #{acquisitionMedalNum},
	star_num = #{starNum},
	rank = #{rank},
	rank_update_datetime = #{rankUpdateDatetime},
	jchallenge_impl_possible_times = #{jchallengeImplPossibleTimes},
	favorite_club_config = #{favoriteClubConfig},
	member_info_regist = #{memberInfoRegist},
	otp_id_regist = #{otpIdRegist},
	continuation_medal = #{continuationMedal},
	aeon_checkin_arrival_num = #{aeonCheckinArrivalNum},
	sns_share_arrival_num = #{snsShareArrivalNum},
	latest_sns_share_challenge_imple_datetime = #{latestSnsShareChallengeImpleDatetime},
	sns_share_challenge_possible_flg = #{snsShareChallengePossibleFlg},
	login_num = #{loginNum},
	login_level = #{loginLevel},
	final_login_datetime = #{finalLoginDatetime},
	stadium_checkin_num = #{stadiumCheckinNum},
	stadium_checkin_level = #{stadiumCheckinLevel},
	meijiyasuda_event_final_join_date = #{meijiyasudaEventFinalJoinDate},
	ad_code_input_datetime = #{adCodeInputDatetime},
	not_yet_acquired_ad_code_medal = #{notYetAcquiredAdCodeMedal},
	not_yet_acquired_apology_bonus_medal_flg = #{notYetAcquiredApologyBonusMedalFlg},
	update_datetime = #{updateDatetime}
where member_id = #{memberId}
</update>

<delete id="delete" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO">
	delete from i_bc_member_medal_status where member_id = #{memberId}
</delete>

	<update id="updateIBcMemberMedalStatus" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO">
		update i_bc_member_medal_status
		   set stadium_checkin_num = stadium_checkin_num + 1,
		       update_datetime = #{updateDatetime}
	     where member_id = #{memberId}
	</update>

	<update id="updateSnsShareTosen" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO">
		update i_bc_member_medal_status
		   set sns_share_arrival_num = #{snsShareArrivalNum},
			   sns_share_challenge_possible_flg = #{snsShareChallengePossibleFlg},
			   latest_sns_share_challenge_imple_datetime = #{latestSnsShareChallengeImpleDatetime},
			   update_datetime = #{updateDatetime}
		where member_id = #{memberId}
	</update>

	<update id="updateSnsShareChallengePossibleFlgOn" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO">
		update i_bc_member_medal_status
		   set sns_share_challenge_possible_flg = #{snsShareChallengePossibleFlg},
		       update_datetime = #{updateDatetime}
	     where member_id = #{memberId}
	</update>

	<update id="updateAeonCheckinTosen" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO">
		update i_bc_member_medal_status
		   set aeon_checkin_arrival_num = #{aeonCheckinArrivalNum},
		       update_datetime = #{updateDatetime}
	     where member_id = #{memberId}
	</update>

	<select id="selectThisMonthCodeUsedCheck" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO" resultType="java.lang.Integer">
		select
			count(*)
		from
			i_bc_member_medal_status
		where
			    member_id = #{memberId}
			and DATE_FORMAT(ad_code_input_datetime,'%Y%m') = DATE_FORMAT(#{adCodeInputDatetime},'%Y%m')
	</select>

	<update id="updateNotYetAcquiredAdCodeMedal" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO">
		update
			i_bc_member_medal_status
		set
			not_yet_acquired_ad_code_medal = not_yet_acquired_ad_code_medal +2
			,ad_code_input_datetime = #{adCodeInputDatetime}
			,update_datetime = #{updateDatetime}
		where
			member_id = #{memberId};
	</update>

	<update id="updateJchallengeTimesMinus" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO">
		update
			i_bc_member_medal_status
		set
			jchallenge_impl_possible_times = jchallenge_impl_possible_times - 1,
			update_datetime = #{updateDatetime}
		where
			member_id = #{memberId};
	</update>

	<select id="selectCheckinFlgCountCheck" parameterType="jp.jleague.club.api.dao.masterdb.dto.IBcMemberMedalStatusDTO" resultType="java.lang.Integer">
		select
			count(*)
		from
			i_bc_member_medal_status
		where
				done_stadium_checkin_flg = #{doneStadiumCheckinFlg}
			and member_id = #{memberId}
</select>

</mapper>
