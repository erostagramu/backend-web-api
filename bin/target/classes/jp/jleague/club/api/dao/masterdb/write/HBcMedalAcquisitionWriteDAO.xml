<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.jleague.club.api.dao.masterdb.write.HBcMedalAcquisitionWriteDAO">

	<resultMap type="jp.jleague.club.api.dao.masterdb.dto.HBcMedalAcquisitionDTO" id="HBcMedalAcquisitionDTO">
		<result column="member_medal_acquisition_serial_number" property="memberMedalAcquisitionSerialNumber" javaType="java.lang.Integer" />
		<result column="member_id" property="memberId" javaType="java.lang.String" />
		<result column="medal_kind_id" property="medalKindId" javaType="java.lang.Integer" />
		<result column="club_id" property="clubId" javaType="java.lang.String" />
		<result column="club_name_roughly" property="clubNameRoughly" javaType="java.lang.String" />
		<result column="checkin_history_serial_number" property="checkinHistorySerialNumber" javaType="java.lang.Integer" />
		<result column="regist_datetime" property="registDatetime" javaType="java.util.Date" />
	</resultMap>

	<select id="selectStudiumCIMedalHis" parameterType="jp.jleague.club.api.dao.masterdb.dto.HBcMedalAcquisitionDTO" resultMap="HBcMedalAcquisitionDTO">
		select checkin_history_serial_number
		from h_bc_medal_acquisition
		where member_id = #{memberId}
		  and medal_kind_id = #{medalKindId}
		  and checkin_history_serial_number = #{checkinHistorySerialNumber}
		order by regist_datetime desc
	</select>

	<select id="selectMedalAcquiredByMedalId" parameterType="jp.jleague.club.api.dao.masterdb.dto.HBcMedalAcquisitionDTO" resultMap="HBcMedalAcquisitionDTO">
		select
			member_medal_acquisition_serial_number,
			member_id,
			medal_kind_id,
			club_id,
			club_name_roughly,
			checkin_history_serial_number,
			regist_datetime
		from h_bc_medal_acquisition
		where member_id = #{memberId}
		  and medal_kind_id = #{medalKindId}
		  <if test="clubId != null">
		   and club_id = #{clubId}
		  </if>
		order by member_medal_acquisition_serial_number desc
	</select>

	<select id="selectMedalAcquiredByMedalGroupLimit1" parameterType="java.util.Map" resultMap="HBcMedalAcquisitionDTO">
		select
			member_medal_acquisition_serial_number,
			member_id,
			medal_kind_id,
			club_id,
			club_name_roughly,
			checkin_history_serial_number,
			regist_datetime
		from h_bc_medal_acquisition
		where member_id = #{memberId}
		  and medal_kind_id like '${medalGroup}%'
		  <if test="clubId != null">
		   and club_id = #{clubId}
		  </if>
		order by medal_kind_id desc
		limit 1
	</select>

	<select id="selectAcquiredMedalsOrderByRegistDateLimit3" parameterType="java.lang.String" resultMap="HBcMedalAcquisitionDTO">
		select
			member_medal_acquisition_serial_number,
			member_id,
			medal_kind_id,
			club_id,
			club_name_roughly,
			checkin_history_serial_number,
			regist_datetime
		from h_bc_medal_acquisition
		where member_id = #{memberId}
		order by regist_datetime desc
		limit 3
	</select>

	<insert id="insertMedalAcquisitionHistory" parameterType="jp.jleague.club.api.dao.masterdb.dto.HBcMedalAcquisitionDTO">
		insert into h_bc_medal_acquisition
			(
				member_id,
				medal_kind_id,
				club_id,
				club_name_roughly,
				checkin_history_serial_number,
				regist_datetime
			) values (
				#{memberId},
				#{medalKindId},
				#{clubId},
				#{clubNameRoughly},
				#{checkinHistorySerialNumber},
				#{registDatetime}
			);
	</insert >

</mapper>
