<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.jleague.club.api.dao.masterdb.read.HBcMedalAcquisitionReadDAO">

	<resultMap type="jp.jleague.club.api.dao.masterdb.dto.HBcMedalAcquisitionDTO" id="HBcMedalAcquisitionDTO">
		<result column="member_medal_acquisition_serial_number" property="memberMedalAcquisitionSerialNumber" javaType="java.lang.Integer" />
		<result column="member_id" property="memberId" javaType="java.lang.String" />
		<result column="medal_kind_id" property="medalKindId" javaType="java.lang.Integer" />
		<result column="club_id" property="clubId" javaType="java.lang.String" />
		<result column="club_name_roughly" property="clubNameRoughly" javaType="java.lang.String" />
		<result column="checkin_history_serial_number" property="checkinHistorySerialNumber" javaType="java.lang.Integer" />
		<result column="regist_datetime" property="registDatetime" javaType="java.util.Date" />
	</resultMap>

	<select id="selectStudiumCIMedalHis" parameterType="jp.jleague.club.api.dao.masterdb.dto.HBcMedalAcquisitionDTO" resultMap="HBcMedalAcquisitionDTO">
		select checkin_history_serial_number
		from h_bc_medal_acquisition
		where member_id = #{memberId}
		  and medal_kind_id = #{medalKindId}
		  and checkin_history_serial_number = #{checkinHistorySerialNumber}
		order by regist_datetime desc
	</select>

	<select id="selectAcquiredMedalsOrderByRegistDateLimit2" parameterType="java.lang.String" resultMap="HBcMedalAcquisitionDTO">
		select
			member_medal_acquisition_serial_number,
			member_id,
			medal_kind_id,
			club_id,
			club_name_roughly,
			checkin_history_serial_number,
			regist_datetime
		from h_bc_medal_acquisition
		where member_id = #{memberId}
		order by regist_datetime desc
		limit 2
	</select>

	<select id="selectCountByMedalId" parameterType="jp.jleague.club.api.dao.masterdb.dto.HBcMedalAcquisitionDTO" resultType="int">
		select count(*)
		from h_bc_medal_acquisition
		where member_id = #{memberId}
		  and medal_kind_id = #{medalKindId}
	</select>

	<select id="selectMedalsGetHistExceptCiOrderbyDate" resultMap="HBcMedalAcquisitionDTO">
		select
			medal_kind_id,
			club_id,
			club_name_roughly,
			regist_datetime
		from h_bc_medal_acquisition
		where member_id = #{memberId}
		  and medal_kind_id not in (0, 1200, 1400)
		order by regist_datetime desc
		<if test="limit != null">limit <if test="offset != null">#{offset}, </if>#{limit}</if>
	</select>

</mapper>
