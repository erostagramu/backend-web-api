<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.jleague.club.api.dao.masterdb.read.IJchallengeTicketInvitationCodeReadDAO">

	<resultMap id="IJchallengeTicketInvitationCodeDTO" type="jp.jleague.club.api.dao.masterdb.dto.IJchallengeTicketInvitationCodeDTO">
		<result column="jc_promo_code_serial_number" property="jcPromoCodeSerialNumber" javaType="java.lang.Integer" />
		<result column="promo_code" property="promoCode" javaType="java.lang.String" />
		<result column="promo_code_get_member_id" property="promoCodeGetMemberId" javaType="java.lang.String" />
		<result column="promo_code_issue_datetime" property="promoCodeIssueDatetime" javaType="java.util.Date" />
		<result column="promo_code_use_limit_date" property="promoCodeUseLimitDate" javaType="java.util.Date" />
		<result column="promo_code_use_member_id" property="promoCodeUseMemberId" javaType="java.lang.String" />
		<result column="promo_code_use_datetime" property="promoCodeUseDatetime" javaType="java.util.Date" />
		<result column="game_id" property="gameId" javaType="java.lang.String" />
		<result column="delete_flg" property="deleteFlg" javaType="java.lang.Integer" />
		<result column="regist_datetime" property="registDatetime" javaType="java.util.Date" />
		<result column="update_datetime" property="updateDatetime" javaType="java.util.Date" />	
	</resultMap>


	<sql id="All_Column_List">
		jc_promo_code_serial_number,
		promo_code,
		promo_code_get_member_id,
		promo_code_issue_datetime,
		promo_code_use_limit_date,
		promo_code_use_member_id,
		promo_code_use_datetime,
		game_id,
		delete_flg,
		regist_datetime,
		update_datetime
	</sql>

	<select id="selectPCodeCheck" resultType="java.lang.Integer">
		select 
			count(*)
		from
			i_jc_promo_code
		where
			promo_code = #{pCode}
	</select>
	
	<select id="selectUnconsumedPromoCode" resultMap="IJchallengeTicketInvitationCodeDTO">
	select 
		<include refid="All_Column_List" />
	from 
		i_jc_promo_code
	where 
		    promo_code_get_member_id  = #{promoCodeGetMemberId}
		and promo_code_use_limit_date > #{promoCodeUseLimitDate}
		and promo_code_use_member_id is null
	</select>
	
	<select id="selectUsedPromotionCode" resultMap="IJchallengeTicketInvitationCodeDTO">
	select 
		<include refid="All_Column_List" />
	from 
		i_jc_promo_code
	where 
		promo_code_use_member_id = #{promoCodeUseMemberId}
	</select>
		
</mapper> 
